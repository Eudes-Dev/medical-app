# Test Design: Story 3.2 – Vue Calendrier

Date: 2026-01-29
Designer: Quinn (Test Architect)

## Test Strategy Overview

- Total test scenarios: 18
- Unit tests: 5 (28%)
- Integration tests: 9 (50%)
- E2E tests: 4 (22%)
- Priority distribution: P0: 8, P1: 8, P2: 2

**Justification des niveaux :** La logique de positionnement des RDV (top/height %) et les calculs de plage sont testés en unitaire. La Server Action getAppointmentsByDateRange (auth, filtre showCancelled, intersection de plages) est testée en intégration. Les parcours utilisateur (grille, navigation, vue jour/semaine, drawer) sont couverts en E2E.

## Test Scenarios by Acceptance Criteria

### AC1: La page `/dashboard/calendar` affiche une grille calendrier

| ID           | Level       | Priority | Test                                                | Justification                    |
| ------------ | ----------- | -------- | --------------------------------------------------- | -------------------------------- |
| 3.2-INT-001  | Integration | P0       | getAppointmentsByDateRange retourne les RDV avec patient pour une plage | Données affichées dans la grille |
| 3.2-E2E-001  | E2E         | P1       | Page /dashboard/calendar affiche la grille et le header (titre, navigation) | Parcours critique utilisateur    |

### AC2: La vue Semaine affiche les 7 jours avec les créneaux horaires (8h-20h)

| ID           | Level       | Priority | Test                                                | Justification                    |
| ------------ | ----------- | -------- | --------------------------------------------------- | -------------------------------- |
| 3.2-INT-002  | Integration | P0       | getAppointmentsByDateRange avec plage semaine appelle Prisma avec startTime/endTime corrects | Plage requête = 7 jours 8h–20h   |
| 3.2-E2E-002  | E2E         | P1       | Vue Semaine affiche 7 colonnes de jours             | Rendu UI                         |

### AC3: La vue Jour affiche une colonne avec les créneaux horaires détaillés

| ID           | Level       | Priority | Test                                                | Justification                    |
| ------------ | ----------- | -------- | --------------------------------------------------- | -------------------------------- |
| 3.2-INT-003  | Integration | P1       | getAppointmentsByDateRange avec plage jour (même jour 8h–20h) retourne les RDV du jour | Plage requête vue jour           |
| 3.2-E2E-003  | E2E         | P1       | Vue Jour affiche une seule colonne de créneaux      | Rendu UI                         |

### AC4: Les rendez-vous existants s'affichent sur les créneaux correspondants

| ID           | Level       | Priority | Test                                                | Justification                    |
| ------------ | ----------- | -------- | --------------------------------------------------- | -------------------------------- |
| 3.2-UNIT-001 | Unit        | P0       | calculateTop(position verticale) selon heure de début (8h–20h) | Logique de positionnement pure   |
| 3.2-UNIT-002 | Unit        | P0       | calculateHeight(hauteur) selon durée en minutes     | Logique de hauteur pure          |
| 3.2-UNIT-003 | Unit        | P1       | getDurationMinutes calcule la durée entre startTime et endTime | Calcul durée pour affichage      |
| 3.2-INT-004  | Integration | P0       | Requête Prisma filtre par intersection startTime &lt; endDate ET endTime &gt; startDate | RDV affichés sur les bons créneaux |

### AC5: Les rendez-vous affichent : nom du patient, heure, durée, statut (couleur)

| ID           | Level       | Priority | Test                                                | Justification                    |
| ------------ | ----------- | -------- | --------------------------------------------------- | -------------------------------- |
| 3.2-INT-005  | Integration | P0       | getAppointmentsByDateRange inclut patient (firstName, lastName) dans la réponse | Données pour nom + affichage     |
| 3.2-UNIT-004 | Unit        | P1       | Couleur selon statut : CONFIRMED=emerald, PENDING=amber, CANCELLED=rose | Palette Dev Notes                |
| 3.2-E2E-004  | E2E         | P2       | Clic sur un RDV ouvre le drawer (détail) avec nom, heure, durée, statut | Parcours mobile                  |

### AC6: La navigation permet de changer de semaine/jour avec les boutons précédent/suivant

Couvert par le store (Story 3.1 : goToNext, goToPrevious). E2E optionnel : 3.2-E2E-002 couvre la vue semaine ; un scénario E2E peut valider le changement de période via les boutons.

| ID           | Level       | Priority | Test                                                | Justification                    |
| ------------ | ----------- | -------- | --------------------------------------------------- | -------------------------------- |
| 3.2-E2E-005  | E2E         | P1       | Boutons précédent/suivant changent la période affichée (titre) | Parcours utilisateur             |

### AC7: Un bouton "Aujourd'hui" ramène à la date courante

Couvert par le store (Story 3.1 : goToToday).

| ID           | Level       | Priority | Test                                                | Justification                    |
| ------------ | ----------- | -------- | --------------------------------------------------- | -------------------------------- |
| 3.2-E2E-006  | E2E         | P1       | Bouton "Aujourd'hui" ramène au titre du jour actuel | Parcours utilisateur             |

### AC8: La grille est responsive (adaptée mobile et desktop)

| ID           | Level       | Priority | Test                                                | Justification                    |
| ------------ | ----------- | -------- | --------------------------------------------------- | -------------------------------- |
| 3.2-INT-006  | Integration | P1       | getAppointmentsByDateRange exclut CANCELLED quand showCancelled false | Filtre côté serveur              |
| 3.2-INT-007  | Integration | P0       | getAppointmentsByDateRange lève UnauthorizedError si non authentifié | Sécurité                         |
| 3.2-INT-008  | Integration | P1       | getAppointmentsByDateRange inclut CANCELLED quand showCancelled true | Option afficher annulés          |
| 3.2-UNIT-005 | Unit        | P2       | calculateTop/calculateHeight bornent aux limites 0–100 % (hors plage 8h–20h) | Edge cases positionnement        |

*AC8 (responsive) : pas de scénario dédié unit/int ; validable en E2E ou manuel (media queries, drawer mobile).*

## Risk Coverage

- **Données incorrectes / plage** : 3.2-INT-001 à 3.2-INT-004 (plage, intersection, filtre).
- **Non authentifié** : 3.2-INT-007.
- **Positionnement RDV** : 3.2-UNIT-001, 3.2-UNIT-002, 3.2-UNIT-003, 3.2-UNIT-005.
- **Affichage statuts** : 3.2-UNIT-004, 3.2-INT-006, 3.2-INT-008.

## Recommended Execution Order

1. P0 Unit : 3.2-UNIT-001, 3.2-UNIT-002 (positionnement).
2. P0 Integration : 3.2-INT-001, 3.2-INT-004, 3.2-INT-005, 3.2-INT-007.
3. P1 Unit : 3.2-UNIT-003, 3.2-UNIT-004.
4. P1 Integration : 3.2-INT-002, 3.2-INT-003, 3.2-INT-006, 3.2-INT-008.
5. P1 E2E : 3.2-E2E-001 à 3.2-E2E-003, 3.2-E2E-005, 3.2-E2E-006.
6. P2 : 3.2-UNIT-005, 3.2-E2E-004.

## Gate YAML Block (for quality gate)

```yaml
test_design:
  scenarios_total: 18
  by_level:
    unit: 5
    integration: 9
    e2e: 4
  by_priority:
    p0: 8
    p1: 8
    p2: 2
  coverage_gaps: []
```

Test design matrix: docs/qa/assessments/3.2-test-design-20260129.md  
P0 tests identified: 8
