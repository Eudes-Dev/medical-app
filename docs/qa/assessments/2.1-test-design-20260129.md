# Test Design: Story 2.1

Date: 2026-01-29
Designer: Quinn (Test Architect)

## Test Strategy Overview

- Total test scenarios: 15
- Unit tests: 4 (27%)
- Integration tests: 7 (47%)
- E2E tests: 4 (27%)
- Priority distribution: P0: 8, P1: 5, P2: 2

## Test Scenarios by Acceptance Criteria

### AC1: Le dashboard `/dashboard` affiche les statistiques du jour (nombre de RDV, prochains RDV)

#### Scenarios

| ID           | Level       | Priority | Test                                    | Justification                              |
| ------------ | ----------- | -------- | --------------------------------------- | ------------------------------------------ |
| 2.1-INT-001  | Integration | P0       | getDashboardStats retourne les RDV du jour | Validation de la requête Prisma avec filtres de date |
| 2.1-INT-002  | Integration | P0       | getDashboardStats retourne les 5 prochains RDV | Validation du tri et de la limite |
| 2.1-INT-003  | Integration | P1       | getDashboardStats filtre par statut CONFIRMED/PENDING | Validation du filtre de statut |
| 2.1-E2E-001  | E2E         | P1       | Dashboard affiche les statistiques correctement | Validation de l'affichage utilisateur |

### AC2: La page `/dashboard/patients` affiche une table interactive avec tous les patients

#### Scenarios

| ID           | Level       | Priority | Test                                    | Justification                              |
| ------------ | ----------- | -------- | --------------------------------------- | ------------------------------------------ |
| 2.1-INT-004  | Integration | P0       | getPatients retourne tous les patients sans filtre | Validation de la requête Prisma de base |
| 2.1-E2E-002  | E2E         | P0       | Page patients affiche la table avec données | Validation du rendu complet de la page |

### AC3: La table utilise les composants Shadcn Data Table

#### Scenarios

| ID           | Level       | Priority | Test                                    | Justification                              |
| ------------ | ----------- | -------- | --------------------------------------- | ------------------------------------------ |
| 2.1-UNIT-001 | Unit        | P2       | PatientDataTable rend les colonnes correctement | Validation du rendu des colonnes |
| 2.1-E2E-003  | E2E         | P1       | Table utilise les styles Shadcn UI | Validation visuelle de l'intégration UI |

### AC4: La recherche par nom/prénom/email filtre les résultats en temps réel

#### Scenarios

| ID           | Level       | Priority | Test                                    | Justification                              |
| ------------ | ----------- | -------- | --------------------------------------- | ------------------------------------------ |
| 2.1-INT-005  | Integration | P0       | getPatients filtre par firstName avec recherche | Validation du filtre OR Prisma |
| 2.1-INT-006  | Integration | P0       | getPatients filtre par lastName avec recherche | Validation du filtre OR Prisma |
| 2.1-INT-007  | Integration | P0       | getPatients filtre par email avec recherche | Validation du filtre OR Prisma |
| 2.1-UNIT-002 | Unit        | P1       | useDebounce retarde la mise à jour de 300ms | Validation de la logique de debounce |
| 2.1-E2E-004  | E2E         | P1       | Recherche filtre les résultats en temps réel | Validation du comportement utilisateur |

### AC5: La pagination permet de naviguer entre les pages de résultats (10 patients par page)

#### Scenarios

| ID           | Level       | Priority | Test                                    | Justification                              |
| ------------ | ----------- | -------- | --------------------------------------- | ------------------------------------------ |
| 2.1-INT-008  | Integration | P0       | getPatients retourne 10 résultats avec pagination | Validation de skip/take Prisma |
| 2.1-INT-009  | Integration | P1       | getPatients retourne le total correct pour pagination | Validation du count avec filtres |
| 2.1-UNIT-003 | Unit        | P1       | PatientDataTable gère la pagination correctement | Validation de la logique de pagination |

### AC6: Chaque ligne permet d'accéder à la fiche détaillée du patient

#### Scenarios

| ID           | Level       | Priority | Test                                    | Justification                              |
| ------------ | ----------- | -------- | --------------------------------------- | ------------------------------------------ |
| 2.1-UNIT-004 | Unit        | P1       | PatientDataTable génère les liens corrects | Validation de la génération d'URL |
| 2.1-E2E-005  | E2E         | P1       | Clic sur "Voir" navigue vers la fiche patient | Validation de la navigation |

### AC7: Un skeleton de chargement s'affiche pendant le fetch des données

#### Scenarios

| ID           | Level       | Priority | Test                                    | Justification                              |
| ------------ | ----------- | -------- | --------------------------------------- | ------------------------------------------ |
| 2.1-E2E-006  | E2E         | P2       | Skeleton s'affiche pendant le chargement | Validation de l'UX de chargement |

## Risk Coverage

### Risques identifiés

- **RISK-001**: Requêtes Prisma non optimisées → Couvert par INT-001 à INT-009
- **RISK-002**: Recherche non performante → Couvert par UNIT-002 (debounce)
- **RISK-003**: Pagination incorrecte → Couvert par INT-008, INT-009, UNIT-003
- **RISK-004**: Données sensibles exposées → À vérifier dans la revue de sécurité

## Recommended Execution Order

1. P0 Unit tests (fail fast)
   - UNIT-002 (useDebounce)
2. P0 Integration tests
   - INT-001, INT-002, INT-004, INT-005, INT-006, INT-007, INT-008
3. P0 E2E tests
   - E2E-002 (affichage table)
4. P1 tests in order
   - INT-003, INT-009, UNIT-001, UNIT-003, UNIT-004, E2E-001, E2E-003, E2E-004, E2E-005
5. P2 tests
   - E2E-006

## Coverage Gaps

### Tests manquants identifiés

1. **Test d'authentification**: Vérifier que les Server Actions retournent des données vides si non authentifié
   - ID suggéré: 2.1-INT-010
   - Priority: P0
   - Justification: Sécurité critique

2. **Test de gestion d'erreurs**: Vérifier la gestion d'erreurs Prisma
   - ID suggéré: 2.1-INT-011
   - Priority: P1
   - Justification: Fiabilité

3. **Test de performance**: Vérifier les performances avec un grand nombre de patients
   - ID suggéré: 2.1-INT-012
   - Priority: P2
   - Justification: Scalabilité

4. **Test de recherche insensible à la casse**: Vérifier que la recherche fonctionne avec différentes casse
   - ID suggéré: 2.1-INT-013
   - Priority: P1
   - Justification: UX

## Notes d'implémentation

### Framework de test recommandé

- **Unit tests**: Vitest ou Jest avec React Testing Library
- **Integration tests**: Vitest avec Prisma Client mock ou test database
- **E2E tests**: Playwright ou Cypress

### Configuration requise

- Base de données de test avec données de seed
- Mock de Supabase Auth pour les tests d'intégration
- Configuration de test pour Next.js Server Actions
