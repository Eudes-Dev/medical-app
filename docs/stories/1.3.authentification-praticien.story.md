# Story 1.3: Authentification Praticien

## Status
Draft

## Story
**As a** praticien,
**I want** me connecter de manière sécurisée à mon espace de gestion,
**so that** seul moi puisse accéder aux données de mes patients et à mon agenda.

## Acceptance Criteria
1. Supabase Auth est configuré et intégré au projet
2. Une page de login (`/login`) est créée avec un formulaire email/mot de passe
3. Le formulaire de login valide les entrées avec Zod
4. La connexion réussie redirige vers `/dashboard`
5. Un middleware Next.js protège toutes les routes `/dashboard/**`
6. Les utilisateurs non authentifiés sont redirigés vers `/login`
7. Un bouton de déconnexion est fonctionnel

## Tasks / Subtasks
- [ ] Task 1: Configuration Supabase Auth (AC: 1)
  - [ ] Installer `@supabase/supabase-js` et `@supabase/auth-helpers-nextjs`
  - [ ] Créer `lib/supabase/client.ts` pour le client côté navigateur
  - [ ] Créer `lib/supabase/server.ts` pour le client côté serveur
  - [ ] Ajouter les variables d'environnement: `NEXT_PUBLIC_SUPABASE_URL`, `NEXT_PUBLIC_SUPABASE_ANON_KEY`
- [ ] Task 2: Page de Login (AC: 2)
  - [ ] Créer `/app/(auth)/login/page.tsx`
  - [ ] Créer le composant `LoginForm` avec Shadcn UI (Card, Input, Button)
  - [ ] Appliquer le design system (couleurs Blue-600, Slate-900)
- [ ] Task 3: Validation Zod (AC: 3)
  - [ ] Installer `zod` et `@hookform/resolvers`
  - [ ] Créer le schéma de validation `loginSchema` (email requis et valide, password requis min 6 caractères)
  - [ ] Intégrer avec react-hook-form
- [ ] Task 4: Logique de connexion (AC: 4)
  - [ ] Créer une Server Action `signIn` dans `/app/(auth)/login/actions.ts`
  - [ ] Implémenter `supabase.auth.signInWithPassword()`
  - [ ] Rediriger vers `/dashboard` après connexion réussie
  - [ ] Afficher les erreurs en cas d'échec
- [ ] Task 5: Middleware de protection (AC: 5, 6)
  - [ ] Créer `middleware.ts` à la racine du projet
  - [ ] Configurer le matcher pour `/dashboard/:path*`
  - [ ] Vérifier la session Supabase
  - [ ] Rediriger vers `/login` si non authentifié
- [ ] Task 6: Déconnexion (AC: 7)
  - [ ] Créer un composant `LogoutButton`
  - [ ] Implémenter `supabase.auth.signOut()`
  - [ ] Rediriger vers `/login` après déconnexion

## Dev Notes

### Architecture de l'Information
- **Espace Privé (Dashboard)**: Toutes les routes sous `/dashboard/*` sont protégées
  - `/dashboard`: Vue d'ensemble
  - `/dashboard/calendar`: Agenda interactif
  - `/dashboard/patients`: Gestion des patients
  - `/dashboard/settings`: Configuration du cabinet
[Source: docs/front-end-spec/1-architecture-de-linformation-sitemap.md]

### Stratégie de Validation (Zod)
- **Côté Client**: Feedback immédiat sous les champs de saisie
- **Côté Serveur**: Double vérification dans les Server Actions avant traitement
[Source: docs/front-end-spec.md - Section 4]

### Design System
- Utiliser les composants Shadcn UI (Card, Input, Button)
- Couleur principale pour les boutons: Blue-600 (#2563eb)
- Couleur d'erreur: Rose-500
[Source: docs/front-end-spec/2-design-system-ui-components.md]

### Variables d'environnement requises
- `NEXT_PUBLIC_SUPABASE_URL`: URL du projet Supabase
- `NEXT_PUBLIC_SUPABASE_ANON_KEY`: Clé anonyme Supabase

### Testing
- Tester la connexion avec des identifiants valides
- Tester le rejet avec des identifiants invalides
- Vérifier la protection des routes `/dashboard/*`
- Vérifier la redirection après déconnexion

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-25 | 1.0 | Création initiale de la story | SM Agent (Bob) |
