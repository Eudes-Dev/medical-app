# Story 4.1: Page de Réservation Publique

## Status
Draft

## Story
**As a** patient,
**I want** accéder à une page publique pour voir les créneaux disponibles du cabinet,
**so that** je puisse choisir un rendez-vous qui me convient sans avoir besoin de créer un compte.

## Acceptance Criteria
1. La route dynamique `/[cabinet-slug]` affiche la page d'accueil du cabinet
2. La page affiche les informations de base du cabinet (nom, adresse, horaires)
3. Un bouton "Prendre RDV" mène vers `/[cabinet-slug]/book`
4. La page `/[cabinet-slug]/book` affiche les créneaux disponibles
5. L'interface de sélection de créneau est optimisée pour mobile (touch-friendly)
6. Seuls les créneaux non-occupés sont affichables et sélectionnables
7. La sélection d'un créneau passe à l'étape suivante (formulaire invité)

## Tasks / Subtasks
- [ ] Task 1: Route dynamique cabinet (AC: 1, 2)
  - [ ] Créer `/app/(public)/[cabinet-slug]/page.tsx`
  - [ ] Créer un composant `CabinetHeader` avec:
    - Nom du cabinet
    - Adresse
    - Horaires d'ouverture
    - Numéro de téléphone
  - [ ] Pour MVP: utiliser des données hardcodées ou variables d'environnement
- [ ] Task 2: Landing page cabinet (AC: 3)
  - [ ] Design responsive avec Shadcn UI (Card, Button)
  - [ ] CTA principal: bouton "Prendre Rendez-vous"
  - [ ] Navigation vers `/[cabinet-slug]/book`
- [ ] Task 3: Page de réservation (AC: 4)
  - [ ] Créer `/app/(public)/[cabinet-slug]/book/page.tsx`
  - [ ] Créer un composant `BookingCalendar`
  - [ ] Afficher un sélecteur de date (calendrier mois)
  - [ ] Afficher les créneaux horaires disponibles pour la date sélectionnée
- [ ] Task 4: Server Action - Créneaux disponibles (AC: 6)
  - [ ] Créer `/app/(public)/[cabinet-slug]/book/actions.ts`
  - [ ] Implémenter `getAvailableSlots(date: Date)`
  - [ ] Générer les créneaux possibles (8h-18h, intervalles de 30min)
  - [ ] Exclure les créneaux déjà occupés (query Prisma)
  - [ ] Retourner la liste des créneaux libres
- [ ] Task 5: Interface mobile-first (AC: 5)
  - [ ] Utiliser des boutons larges pour les créneaux (min 44px)
  - [ ] Grille de créneaux 2 colonnes sur mobile, 4 sur desktop
  - [ ] Scroll horizontal pour le sélecteur de dates
  - [ ] Feedback visuel au touch (active state)
- [ ] Task 6: Sélection de créneau (AC: 7)
  - [ ] Stocker le créneau sélectionné dans un state local ou Zustand
  - [ ] Afficher le créneau sélectionné en surbrillance (Blue-600)
  - [ ] Bouton "Continuer" activé uniquement si un créneau est sélectionné
  - [ ] Navigation vers l'étape formulaire (story 4.2)

## Dev Notes

### Architecture de l'Information - Espace Public
- `/[tenant-id]`: Landing page du cabinet (présentation, horaires, contact)
- `/[tenant-id]/book`: Tunnel de prise de rendez-vous
  - Étape 1: Sélection du motif et du créneau
  - Étape 2: Formulaire d'identité (Mode Invité)
  - Étape 3: Confirmation et récapitulatif
[Source: docs/front-end-spec/1-architecture-de-linformation-sitemap.md]

### PRD - User Stories
- US.2: En tant que patient (invité), je veux réserver un créneau en 3 clics sans créer de compte.
[Source: docs/prd.md - Section 3]

### Expérience "Invité" (Guest Flow)
1. Le patient ne voit jamais d'écran de "Login" pour prendre RDV
2. Saisie simplifiée: Prénom, Nom, Téléphone, Email
3. Après validation, un cookie temporaire permet au patient de voir son récapitulatif sans compte
[Source: docs/front-end-spec.md - Section 5]

### Design System
- **Drawer (Vaul)**: Utilisé sur mobile pour la prise de RDV rapide
- Couleur principale: Blue-600 (#2563eb) pour les éléments sélectionnés
- Interface touch-friendly avec zones de clic de min 44px
[Source: docs/front-end-spec/2-design-system-ui-components.md]

### Algorithme de génération des créneaux
```typescript
const generateSlots = (date: Date) => {
  const slots = []
  const startHour = 8
  const endHour = 18
  const intervalMinutes = 30
  
  for (let hour = startHour; hour < endHour; hour++) {
    for (let min = 0; min < 60; min += intervalMinutes) {
      const slotTime = new Date(date)
      slotTime.setHours(hour, min, 0, 0)
      slots.push(slotTime)
    }
  }
  return slots
}

const getAvailableSlots = async (date: Date) => {
  const allSlots = generateSlots(date)
  const appointments = await prisma.appointment.findMany({
    where: {
      dateTime: {
        gte: startOfDay(date),
        lt: endOfDay(date),
      },
      status: { not: 'CANCELLED' },
    },
  })
  
  // Filtrer les créneaux occupés
  return allSlots.filter(slot => {
    return !appointments.some(apt => 
      slot >= apt.dateTime && slot < addMinutes(apt.dateTime, apt.duration)
    )
  })
}
```

### Note: Cabinet Slug
Pour le MVP single-tenant, le cabinet-slug peut être une valeur fixe ou ignoré. L'important est de maintenir la structure d'URL pour une future évolution multi-tenant.

### Testing
- Vérifier l'affichage de la landing page du cabinet
- Tester la navigation vers la page de réservation
- Vérifier que seuls les créneaux libres sont affichés
- Tester l'interface sur mobile (touch, responsive)
- Vérifier la sélection de créneau et le passage à l'étape suivante

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-25 | 1.0 | Création initiale de la story | SM Agent (Bob) |
