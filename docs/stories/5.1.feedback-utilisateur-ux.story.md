# Story 5.1: Feedback Utilisateur (UX)

## Status
Draft

## Story
**As a** utilisateur (praticien ou patient),
**I want** avoir des retours visuels clairs pendant les chargements et après mes actions,
**so that** je sache toujours ce qui se passe et que l'application paraisse réactive.

## Acceptance Criteria
1. Des skeletons de chargement s'affichent pendant le fetch de l'agenda
2. Des skeletons s'affichent pendant le chargement de la liste des patients
3. Un toast de succès s'affiche après chaque action réussie (création, modification, suppression)
4. Un toast d'erreur s'affiche en cas d'échec avec un message explicite
5. Les boutons affichent un état de chargement (spinner) pendant les requêtes
6. Les transitions entre les pages sont fluides (pas de flash blanc)
7. Les états vides affichent un message explicite ("Aucun patient", "Aucun RDV")

## Tasks / Subtasks
- [ ] Task 1: Skeleton Agenda (AC: 1)
  - [ ] Créer `/components/calendar/CalendarSkeleton.tsx`
  - [ ] Skeleton pour la grille calendrier (rectangles animés)
  - [ ] Skeleton pour les cards de RDV
  - [ ] Utiliser Shadcn Skeleton ou animation Tailwind `animate-pulse`
  - [ ] Intégrer avec React Suspense dans la page calendar
- [ ] Task 2: Skeleton Liste Patients (AC: 2)
  - [ ] Créer `/components/patients/PatientTableSkeleton.tsx`
  - [ ] Skeleton pour les lignes de table (5-10 lignes)
  - [ ] Skeleton pour le header de recherche
  - [ ] Intégrer avec Suspense dans la page patients
- [ ] Task 3: Configuration Toasts (AC: 3, 4)
  - [ ] Vérifier l'installation de `sonner` (si pas fait dans story 2.2)
  - [ ] Configurer le Toaster dans le layout principal
  - [ ] Créer des fonctions utilitaires dans `/lib/toast.ts`:
    ```typescript
    export const showSuccess = (message: string) => toast.success(message)
    export const showError = (message: string) => toast.error(message)
    ```
- [ ] Task 4: Intégration Toasts (AC: 3, 4)
  - [ ] Ajouter toast succès après:
    - Création patient
    - Modification patient
    - Création RDV
    - Modification/Annulation RDV
    - Réservation invité
  - [ ] Ajouter toast erreur pour:
    - Échec de validation
    - Conflit de créneau
    - Erreur serveur
- [ ] Task 5: États de chargement boutons (AC: 5)
  - [ ] Créer un composant `LoadingButton` (extension de Shadcn Button)
  - [ ] Props: `isLoading`, `loadingText`
  - [ ] Afficher spinner + texte pendant le chargement
  - [ ] Désactiver le bouton pendant le chargement
  - [ ] Intégrer dans tous les formulaires
- [ ] Task 6: Transitions de page (AC: 6)
  - [ ] Configurer le loading.tsx dans les dossiers de route
  - [ ] Utiliser `next/navigation` avec `useTransition` pour les navigations
  - [ ] Ajouter NProgress ou barre de chargement en haut de page (optionnel)
- [ ] Task 7: États vides (AC: 7)
  - [ ] Créer `/components/ui/EmptyState.tsx`
  - [ ] Props: `icon`, `title`, `description`, `action` (bouton optionnel)
  - [ ] Intégrer dans:
    - Liste patients vide: "Aucun patient pour le moment"
    - Agenda sans RDV: "Aucun rendez-vous ce jour"
    - Recherche sans résultat: "Aucun résultat pour votre recherche"

## Dev Notes

### PRD - Critères d'Acceptation
- Le patient reçoit une confirmation visuelle après validation du formulaire
[Source: docs/prd.md - Section 4]

### Design System
- Couleur Succès: Emerald-500 - Pour les toasts de succès
- Couleur Erreur: Rose-500 - Pour les toasts d'erreur
- Couleur Alerte: Amber-500 - Pour les états en attente
[Source: docs/front-end-spec/2-design-system-ui-components.md]

### Composant Skeleton Tailwind
```tsx
// Exemple de skeleton avec Tailwind
const Skeleton = ({ className }: { className?: string }) => (
  <div 
    className={cn(
      "animate-pulse rounded-md bg-slate-200",
      className
    )} 
  />
)

// Usage
<Skeleton className="h-4 w-[250px]" />
<Skeleton className="h-10 w-full" />
```

### Configuration Sonner
```tsx
// app/layout.tsx
import { Toaster } from 'sonner'

export default function RootLayout({ children }) {
  return (
    <html>
      <body>
        {children}
        <Toaster 
          position="top-right"
          toastOptions={{
            classNames: {
              success: 'bg-emerald-500',
              error: 'bg-rose-500',
            },
          }}
        />
      </body>
    </html>
  )
}
```

### LoadingButton composant
```tsx
import { Loader2 } from 'lucide-react'
import { Button, ButtonProps } from './button'

interface LoadingButtonProps extends ButtonProps {
  isLoading?: boolean
  loadingText?: string
}

export function LoadingButton({ 
  isLoading, 
  loadingText = 'Chargement...', 
  children, 
  disabled,
  ...props 
}: LoadingButtonProps) {
  return (
    <Button disabled={isLoading || disabled} {...props}>
      {isLoading ? (
        <>
          <Loader2 className="mr-2 h-4 w-4 animate-spin" />
          {loadingText}
        </>
      ) : children}
    </Button>
  )
}
```

### Testing
- Vérifier l'affichage des skeletons pendant le chargement
- Tester les toasts après chaque action (succès et erreur)
- Vérifier le spinner sur les boutons pendant les requêtes
- Tester les états vides (liste vide, recherche sans résultat)
- Vérifier la fluidité des transitions entre pages

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-25 | 1.0 | Création initiale de la story | SM Agent (Bob) |
