# Story 3.2: Vue Calendrier

## Status
Draft

## Story
**As a** praticien,
**I want** voir mon agenda sous forme de grille interactive,
**so that** je puisse visualiser mes rendez-vous et gérer mon planning quotidien.

## Acceptance Criteria
1. La page `/dashboard/calendar` affiche une grille calendrier
2. La vue Semaine affiche les 7 jours avec les créneaux horaires (8h-20h)
3. La vue Jour affiche une colonne avec les créneaux horaires détaillés
4. Les rendez-vous existants s'affichent sur les créneaux correspondants
5. Les rendez-vous affichent: nom du patient, heure, durée, statut (couleur)
6. La navigation permet de changer de semaine/jour avec les boutons précédent/suivant
7. Un bouton "Aujourd'hui" ramène à la date courante
8. La grille est responsive (adaptée mobile et desktop)

## Tasks / Subtasks
- [ ] Task 1: Structure de la page calendrier (AC: 1)
  - [ ] Créer `/app/(dashboard)/dashboard/calendar/page.tsx`
  - [ ] Créer un composant `CalendarHeader` avec:
    - Titre de la période (ex: "Semaine du 20 janvier 2026")
    - Boutons navigation (précédent, aujourd'hui, suivant)
    - Sélecteur de vue (jour/semaine)
- [ ] Task 2: Composant CalendarGrid (AC: 2, 3)
  - [ ] Créer `/components/calendar/CalendarGrid.tsx`
  - [ ] Implémenter une grille CSS custom (grid-template)
  - [ ] Axe vertical: heures de 8h à 20h (créneaux de 30min)
  - [ ] Axe horizontal: jours (1 pour vue jour, 7 pour vue semaine)
  - [ ] Afficher les lignes de séparation des heures
- [ ] Task 3: Server Action pour les rendez-vous (AC: 4)
  - [ ] Créer `/app/(dashboard)/dashboard/calendar/actions.ts`
  - [ ] Implémenter `getAppointmentsByDateRange(startDate, endDate)`
  - [ ] Inclure les données patient (nom, prénom)
  - [ ] Filtrer par statut si `showCancelled` est false
- [ ] Task 4: Composant AppointmentCard (AC: 5)
  - [ ] Créer `/components/calendar/AppointmentCard.tsx`
  - [ ] Afficher: nom patient, heure début, durée
  - [ ] Appliquer la couleur selon le statut:
    - CONFIRMED: Emerald-500
    - PENDING: Amber-500
    - CANCELLED: Rose-500 (si affiché)
  - [ ] Calculer la hauteur selon la durée
  - [ ] Positionner verticalement selon l'heure de début
- [ ] Task 5: Intégration Zustand (AC: 6, 7)
  - [ ] Utiliser `useCalendarStore` pour:
    - Lire `pivotDate` et `viewMode`
    - Appeler `goToNext()`, `goToPrevious()`, `goToToday()`
  - [ ] Déclencher le fetch des rendez-vous quand pivotDate change
  - [ ] Utiliser le cache si disponible
- [ ] Task 6: Responsive Design (AC: 8)
  - [ ] Sur mobile: vue jour par défaut, swipe pour changer de jour
  - [ ] Sur desktop: vue semaine avec colonnes égales
  - [ ] Utiliser les media queries Tailwind (sm, md, lg)
  - [ ] Drawer (Vaul) sur mobile pour les détails du RDV

## Dev Notes

### Architecture de l'Information
- `/dashboard/calendar`: Agenda interactif (vue jour/semaine/mois)
[Source: docs/front-end-spec/1-architecture-de-linformation-sitemap.md]

### Gestion d'État (Zustand)
Le store `useCalendarStore` gère:
- La date pivot de l'affichage
- Les filtres de vue (ex: masquer les RDV annulés)
- Le cache local pour permettre des transitions instantanées entre les jours
[Source: docs/architecture/3-gestion-dtat-zustand.md]

### Design System - Composants Clés
- **Calendar Engine**: Basé sur une grille CSS custom pour une fluidité maximale sur desktop et mobile
- **Drawer (Vaul)**: Utilisé sur mobile pour la prise de RDV rapide
[Source: docs/front-end-spec/2-design-system-ui-components.md]

### Palette de couleurs pour les statuts
- **Succès (CONFIRMED)**: Emerald-500 - Rendez-vous confirmés
- **Alerte (PENDING)**: Amber-500 - En attente ou modification
- **Erreur (CANCELLED)**: Rose-500 - Annulations
[Source: docs/front-end-spec/2-design-system-ui-components.md]

### Calcul de position CSS
```typescript
// Calcul de la position verticale (top) en pourcentage
const calculateTop = (dateTime: Date) => {
  const hours = dateTime.getHours()
  const minutes = dateTime.getMinutes()
  const totalMinutes = (hours - 8) * 60 + minutes // 8h = début
  const percentage = (totalMinutes / (12 * 60)) * 100 // 12h de plage
  return `${percentage}%`
}

// Calcul de la hauteur selon durée
const calculateHeight = (durationMinutes: number) => {
  const percentage = (durationMinutes / (12 * 60)) * 100
  return `${percentage}%`
}
```

### Testing
- Vérifier l'affichage correct des rendez-vous aux bons créneaux
- Tester la navigation entre les semaines/jours
- Vérifier les couleurs selon le statut
- Tester le responsive sur différentes tailles d'écran
- Vérifier le chargement depuis le cache Zustand

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-25 | 1.0 | Création initiale de la story | SM Agent (Bob) |
