# Story 2.1: Dashboard & Liste des Patients

## Status
Draft

## Story
**As a** praticien,
**I want** voir une liste interactive de tous mes patients avec recherche et pagination,
**so that** je puisse retrouver rapidement les informations d'un patient.

## Acceptance Criteria
1. Le dashboard `/dashboard` affiche les statistiques du jour (nombre de RDV, prochains RDV)
2. La page `/dashboard/patients` affiche une table interactive avec tous les patients
3. La table utilise les composants Shadcn Data Table
4. La recherche par nom/prénom/email filtre les résultats en temps réel
5. La pagination permet de naviguer entre les pages de résultats (10 patients par page)
6. Chaque ligne permet d'accéder à la fiche détaillée du patient
7. Un skeleton de chargement s'affiche pendant le fetch des données

## Tasks / Subtasks
- [ ] Task 1: Layout Dashboard (AC: 1)
  - [ ] Créer `/app/(dashboard)/dashboard/page.tsx`
  - [ ] Créer un composant `DashboardStats` affichant:
    - Nombre de RDV aujourd'hui
    - Prochains RDV (liste des 5 prochains)
  - [ ] Créer une Server Action pour récupérer les statistiques
- [ ] Task 2: Structure de la page patients (AC: 2)
  - [ ] Créer `/app/(dashboard)/dashboard/patients/page.tsx`
  - [ ] Créer le layout avec header "Gestion des Patients"
  - [ ] Ajouter un bouton "Nouveau Patient" (pour story 2.2)
- [ ] Task 3: Composant Data Table (AC: 3)
  - [ ] Installer les dépendances: `@tanstack/react-table`
  - [ ] Ajouter les composants Shadcn: Table, DataTable
  - [ ] Créer `/components/patients/PatientDataTable.tsx`
  - [ ] Définir les colonnes: Nom, Prénom, Email, Téléphone, Actions
- [ ] Task 4: Server Action pour récupérer les patients (AC: 2)
  - [ ] Créer `/app/(dashboard)/dashboard/patients/actions.ts`
  - [ ] Implémenter `getPatients(page, limit, search)` avec Prisma
  - [ ] Retourner les patients avec le compte total pour la pagination
- [ ] Task 5: Recherche (AC: 4)
  - [ ] Ajouter un champ de recherche avec Shadcn Input
  - [ ] Implémenter le filtrage côté serveur (nom, prénom, email)
  - [ ] Utiliser un debounce de 300ms pour éviter les requêtes excessives
- [ ] Task 6: Pagination (AC: 5)
  - [ ] Implémenter la pagination avec `@tanstack/react-table`
  - [ ] Afficher 10 patients par page
  - [ ] Ajouter les contrôles de navigation (précédent, suivant, numéros de page)
- [ ] Task 7: Navigation vers fiche patient (AC: 6)
  - [ ] Ajouter un lien/bouton "Voir" sur chaque ligne
  - [ ] Naviguer vers `/dashboard/patients/[id]`
- [ ] Task 8: Skeleton de chargement (AC: 7)
  - [ ] Créer un composant `PatientTableSkeleton`
  - [ ] Afficher le skeleton pendant le chargement initial
  - [ ] Utiliser Suspense de React pour le loading state

## Dev Notes

### Architecture de l'Information
- `/dashboard`: Vue d'ensemble (statistiques du jour, prochains RDV)
- `/dashboard/patients`: Gestion de la base patient (recherche, fiches détaillées)
[Source: docs/front-end-spec/1-architecture-de-linformation-sitemap.md]

### Logique de Données
- **Relations**: Patient (1) <---> (N) Appointment
- **Accès**: Couche de services via Next.js Server Actions
[Source: docs/architecture/2-logique-de-donnes.md]

### Design System
- Utiliser les composants Shadcn UI (Table, Input, Button)
- Couleur principale: Blue-600 (#2563eb)
- Couleur neutre pour le texte: Slate-900 (#0f172a)
[Source: docs/front-end-spec/2-design-system-ui-components.md]

### Requête Prisma exemple
```typescript
const patients = await prisma.patient.findMany({
  where: {
    OR: [
      { firstName: { contains: search, mode: 'insensitive' } },
      { lastName: { contains: search, mode: 'insensitive' } },
      { email: { contains: search, mode: 'insensitive' } },
    ],
  },
  skip: (page - 1) * limit,
  take: limit,
  orderBy: { lastName: 'asc' },
});
```

### Testing
- Vérifier l'affichage correct de la table avec des données
- Tester la recherche avec différents critères
- Vérifier la pagination (navigation, nombre de résultats)
- Tester l'affichage du skeleton pendant le chargement

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-25 | 1.0 | Création initiale de la story | SM Agent (Bob) |
